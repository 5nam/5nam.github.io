---
layout: single
title:  "[SPRING SECURITY] OAuth 2.0 아키텍처 이해와 보안 취약점 사례"
published : false
categories: spring_security
toc: true
author_profile: false
sidebar:
    nav: "docs"
---

# 1. OAuth 2.0 개요

## 1) OAuth(Open Authorization)

- 인증(Authentication) 은 시스템이나 서비스가 사용자의 신원을 확인하는 과정. 사용자의 신원을 식별하고 무분별한 접근을 차단함으로써 데이터 유출을 방지할 수 있다. 그래서 인증은 보안의 핵심 요소로 웹 서비스 개발 및 설계 시 중요한 고려사항이다.
- 신원 확인을 위한 다양한 인증 수단이 존재
  1. 비밀번호 기반 인증
  2. 2단계 인증(Two-Factor-Authenticatio, 2FA)
  3. 생체 인식
  4. 토큰 기반 인증
  5. 인증서 기반 인증
- 이러한 인증 수단은 사용자가 단일 애플리케이션에 직접적으로 인증 정보를 제공하는 방식
- 이로 인해 애플리케이션이 사용자 인증 정보를 관리하게 되며, 정보 유출의 보안 위험이 상존한다.
- 하나의 서비스에서 유출된 정보는 다른 서비스에도 영향을 줄 수 있다.
- 이런 배경에서 더 안전하고 효율적인 인증 및 권한 부여 메커니즘을 제공하고자 OAuth 가 등장하게 되었다.
- OAuth 는 개방형 표준 인증 프로토콜이다. 사용자의 인증 정보를 직접 공유하지 않고도 서비스 간에 안정한 인증과 권한 위임을 가능하게 한다.
- 이를 통해 사용자는 자신의 계정 정보를 제 3자 애플리케이션에 직접 제공하지 않고도, 해당 애프리케이션이 특정 서비스의 기능을 사용할 수 있도록 권한을 부여할 수 있다.
- 기존의 중앙집중식 인증 모델(LDAP)의 한계를 극복하고, 각 서비스가 사용자의 민감한 인증 정보를 직접 저장하고 관리해야 하는 부담을 줄여준다.
- 결과적으로 OAuth 는 보안성을 강화하면서도 사용자 경험을 개선하고, 서비스 간의 연동을 용이하게 만든다.

## 2) OAuth 버전

- OAuth 에는 1.0, 2.0, 2.1 의 세 가지 주요 버전이 있으며, 현재 널리 사용되고 있는 버전은 OAuth 2.0 이다.
- 각 버전 간의 주요 차이점은 인증 방식과 범용성이 있으며, 버전별 인증 프로세스에 대해 자세히 살펴보겠다.

### OAuth 1.0

**[그림 2] OAuth 1.0 워크플로우**

![img](https://www.igloo.co.kr/wp-content/uploads/2024/10/%EA%B7%B8%EB%A6%BC2-1.jpg)

1. 사용자는 애플리케이션(소비자)을 사용하려고 접근
2. 애플리케이션은 서비스 제공자에게 접근 권한을 요청하기 위해 사용자를 소셜 네트워킹 페이지로 이동
3. 사용자는 본인 인증 수행, 애플리케이션이 서비스 제공자로부터 정보를 제공받는 것을 승인
4. 서비스 제공자는 애플리케이션에게 접근 권한을 부여하고, 애플리케이션은 이를 통해 사용자 정보에 접근

**[한계점]**

- OAuth 1.0은 모든 요청에 대해 암호화된 서명을 생성하고 검증하는 방식 사용
  - 이는 보안성을 강화하는 수단이기도 했지만, 각 요청마다 복잡한 서명 과정을 필요로 하여 서버 측에서 검증 로직을 구현하는데 어려움이 따름
- OAuth 1.0의 제한된 인증 방식으로 인해 모바일 애플리케이션과 같은 다양한 환경에서 사용하기 어려웠고, 이로 인해 다른 플랫폼에서의 적용이 쉽지 않아 확장성이 부족
- OAuth 1.0은 인증 토큰(Access Token) 유효기간에 대한 명확한 스펙이 없어 재사용 가능성이라는 보안 위험 잔존, 토큰을 무효화하려면 서비스 제공자의 애플리케이션에서 비밀번호를 직접 변경해야 함

### OAuth 2.0

**[그림 3] OAuth 2.0 워크플로우**

![img](https://www.igloo.co.kr/wp-content/uploads/2024/10/%EA%B7%B8%EB%A6%BC4-1024x534.jpg)

**[표2] OAuth 2.0 참여자 구분**

| 참여자               | 설명                                                         |
| -------------------- | ------------------------------------------------------------ |
| Resource Owner       | 보호된 자원에 대한 접근 권한을 가진 최종 사용자(개인)로, 자신의 정보(예: 개인정보, 데이터 등)에 대한 접근 권한을 Client 에게 부여 |
| Client               | 사용자를 대신하여 권한을 부여 받아 보호된 사용자의 자원에 접근하려는 애플리케이션 |
| Resource Server      | 사용자의 보호된 자원을 타사 애플리케이션에 호스팅하는 서버   |
| Authorization Server | 실질적인 인증과 인가를 수행하는 서버로 Client 의 접근 자격을 확인하고 권한 부여를 위한 Access Token 을 발급 |

1. 사용자인 Resource Owner는 소셜 로그인을 통해 클라이언트가 제공하는 서비스에 접근하고자 하며, 이를 위한 권한 위임을 요청한다.
2. 클라이언트(Client)는 Authorization Server 에게 Resource Server 가 보호하는 자원에 접근하기 위한 Access Token 발급을 요청한다. 이때, 사용자는 인증(로그인)을 위해 Authorization Server 의 페이지로 이동한다.
3. 사용자는 클라이언트에 대한 권한 위임을 승인한다.
4. Authorization Server 는 클라이언트에게 Access Token 을 발급한다. 이 Access Token 에는 만료기간이 설정되어 있다.
5. 클라이언트는 Resource Server 에게 Access Token 을 전달하여, 사용자의 정보에 접근을 요청한다.
6. Resource Server 는 Access Token 의 유효성을 확인하기 위해 이를 발급한 Authorization Server 에 검증을 요청한다.
7. Authorization Server 가 Access Token 유효성을 확인하면, Resource Server 에게 인증 성공 메시지를 전송한다.
8. Resource Server 는 클라이언트가 요청한 사용자 정보를 반환한다.

### OAuth1.0 과 2.0 차이점

![img](https://www.igloo.co.kr/wp-content/uploads/2024/10/%EA%B7%B8%EB%A6%BC6.jpg)

- 가장 큰 변화는 서버 구조의 분리
  - OAuth 1.0 에서는 인증, 권한 부여, 자원 제공이 단일 서버에서 통합 처리
  - OAuth 2.0 에서는 인증 및 권한 부여 서버와 자원 서버로 분리하여 시스템의 유연성과 확장성을 높임
- 유효 기간 명확한 기술 명세 제시
  - OAuth 2.0 은 Access Token 의 유효 기간에 대한 명확한 기술 명세를 제시하여 토큰 재사용과 관련된 보안 취약점 개선
  - HTTPS 프로토콜을 통한 암호화를 도입함으로써 OAuth 1.0 에서 요구되던 복잡한 서명 과정을 제거
  - 이로 인해 기능 구현 간소화되었고, 다양한 인증 수단을 지원하게 되어 범용성이 향상되었다.

# 02. OAuth 2.0 Token & Client Types

---

출처 : https://www.igloo.co.kr/security-information/spring-security-part2-oauth-2-0-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%9D%B4%ED%95%B4%EC%99%80-%EB%B3%B4%EC%95%88-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%82%AC%EB%A1%80/