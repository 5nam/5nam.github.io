---

layout: single

title:  "[SPRING MVC] MVC í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸°"

---

# 4. MVC í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸°

## í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ íŒ¨í„´ ì†Œê°œ

**í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì… ì „**

- ê° controller(ì„œë¸”ë¦¿)ë§ˆë‹¤ ê³µí†µ ë¡œì§ë“¤ì„ ê°œë°œí•˜ê³ , ê·¸ ë‹¤ìŒ ë³„ë„ì˜ controller(ì„œë¸”ë¦¿) ë¡œì§ì„ ê°œë°œí•˜ëŠ” ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì¡ŒìŒ
- ì¦‰, ê³µí†µì ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì…êµ¬ê°€ ì—†ê³  ê° ì»¨íŠ¸ë¡¤ëŸ¬ë§ˆë‹¤ ê°ìì˜ ì…êµ¬ë¥¼ ê°€ì§„ ê²ƒ

**í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì… í›„**

- **ê³µí†µ ë¡œì§ ì²˜ë¦¬í•˜ëŠ” ì„œë¸”ë¦¿**ì„ í•˜ë‚˜ ë„ì…í•˜ëŠ” ê²ƒ(ë¬¸ì§€ê¸° ì—­í• )

**FrontController íŒ¨í„´ íŠ¹ì§•**

- í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ì„œë¸”ë¦¿ í•˜ë‚˜ë¡œ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë°›ìŒ(ê³µí†µ ì²˜ë¦¬ ê°€ëŠ¥)
- í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìš”ì²­ì— ë§ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì°¾ì•„ì„œ í˜¸ì¶œ
- í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„œë¸”ë¦¿ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¨
  - request ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ HttpServlet ì„ ìƒì†ë°›ëŠ”ê²Œ í•„ìš”í–ˆì—ˆìœ¼ë‚˜, ì´ì œëŠ” FrontController ì—ì„œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë‚˜ë¨¸ì§€ëŠ” Servlet ì´ ì•„ë‹ˆì–´ë„ ë¨

**ìŠ¤í”„ë§ ì›¹ MVC ì™€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬**

- ìŠ¤í”„ë§ ì›¹ MVC ì˜ DispatcherServlet ì´ FrontController íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŒ

## í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì… - V1

### V1 êµ¬ì¡°

1. Client ê°€ HTTP ìš”ì²­
2. FrontController(ì„œë¸”ë¦¿)ê°€ ìš”ì²­ ë°›ìŒ
3. http ìš”ì²­ì˜ url ì •ë³´ë¥¼ ê°€ì§€ê³  ì¡°íšŒí•´ì„œ ì–´ë–¤ controller í˜¸ì¶œí•´ì•¼ í•˜ëŠ”ì§€ ì°¾ê³  í˜¸ì¶œ
4. controller ëŠ” ìê¸° ë¡œì§ ì‹¤í–‰í•˜ê³  JSP foward ë¡œ ì‘ë‹µ ë‚´ë³´ëƒ„

#### ControllerV1 : ì¸í„°í˜ì´ìŠ¤ë¡œ ë§Œë“¤ ê²ƒ, ë‹¤í˜•ì„± í™œìš©

```java
package hello.servlet.web.frontcontroller.v1;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public interface ControllerV1 {

    void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException;
}

```

í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ í˜¸ì¶œí•˜ì—¬ êµ¬í˜„ê³¼ ê´€ê³„ ì—†ì´ ë¡œì§ì˜ ì¼ê´€ì„±ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ

#### MemberFormControllerV1 - íšŒì› ë“±ë¡ ì»¨íŠ¸ë¡¤ëŸ¬

```java
package hello.servlet.web.frontcontroller.v1.controller;

import hello.servlet.web.frontcontroller.v1.ControllerV1;
import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public class MemberFormControllerV1 implements ControllerV1 {
    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}

```

#### MemberSaveControllerV1 - íšŒì› ì €ì¥ ì»¨íŠ¸ë¡¤ëŸ¬

```java
package hello.servlet.web.frontcontroller.v1.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.v1.ControllerV1;
import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public class MemberSaveControllerV1 implements ControllerV1 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        request.setAttribute("member", member);

        String viewPath = "/WEB-INF/views/save-result.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}

```

#### MemberListControllerV1 - íšŒì› ëª©ë¡ ì»¨íŠ¸ë¡¤ëŸ¬

```java
package hello.servlet.web.frontcontroller.v1.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.v1.ControllerV1;
import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.List;

public class MemberListControllerV1 implements ControllerV1 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        List<Member> members = memberRepository.findAll();
        request.setAttribute("members", members);

        String viewPath = "/WEB-INF/views/members.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}

```

íšŒì› í¼/ì €ì¥/ì¡°íšŒ ë‚´ë¶€ ë¡œì§ì€ ê¸°ì¡´ ì„œë¸”ë¦¿ê³¼ê±°ì˜ ê°™ìŒ

#### âœ¨ FrontControllerServletV1 - í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬

```java
package hello.servlet.web.frontcontroller.v1;

import hello.servlet.web.frontcontroller.v1.controller.MemberFormControllerV1;
import hello.servlet.web.frontcontroller.v1.controller.MemberListControllerV1;
import hello.servlet.web.frontcontroller.v1.controller.MemberSaveControllerV1;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerServletV1", urlPatterns = "/front-controller/v1/*")
public class FrontControllerV1 extends HttpServlet {
    private Map<String, ControllerV1> controllerMap = new HashMap<>();

    public FrontControllerV1() {
        controllerMap.put("/front-controller/v1/members/new-form", new MemberFormControllerV1());
        controllerMap.put("/front-controller/v1/members/save", new MemberSaveControllerV1());
        controllerMap.put("/front-controller/v1/members", new MemberListControllerV1());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("FrontControllerServletV1.service");
        String requestURI = req.getRequestURI();

        ControllerV1 controller = controllerMap.get(requestURI);
        if (controller == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        controller.process(req, resp);
    }
}

```

â­ï¸ `urlPatterns = "/front-controller/v1/*"`

- ì´ë ‡ê²Œ urlPatterns ë¥¼ ì§€ì •í•˜ë©´, /front-controller/v1 í•˜ìœ„ì— ì–´ë–¤ url ì´ ë“¤ì–´ì™€ë„ ì´ FrontController ê°€ í˜¸ì¶œ

`private Map<String, ControllerV1> controllerMap = new HashMap<>();`

- Key : URL
- Value : controller ê°ì²´

`FrontControllerV1()` ìƒì„±ì

- ìƒì„±ë  ë•Œ ë§µí•‘ ì •ë³´ë¥¼ ë‹´ì•„ë†“ì€ ê²ƒ
- key ì— ë§ëŠ” ìš”ì²­ì´ ì˜¤ë©´ new í•œ controller ì‹¤í–‰ë˜ë„ë¡ ë§¤í•‘

`ControllerV1 controller = controllerMap.get(requestURI);`

- ë‹¤í˜•ì„±ì— ì˜í•´ ì¸í„°í˜ì´ìŠ¤ë¡œ controller êµ¬í˜„ì²´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
  - ì—†ì—ˆë‹¤ë©´, if-else if ë¡œ íƒ€ì… ì²´í¬í•˜ëŠ” ë“± ë²ˆê±°ë¡œì›€

**ğŸ™ï¸ (ì‹¤ë¬´íŒ)** ì‹¤ë¬´ì—ì„œ ì•„í‚¤í…ì²˜ë¥¼ ê°œì„ í•  ë•Œ

- ê°™ì€ ë ˆë²¨ë¼ë¦¬ë§Œ ê°œì„ í•´ì•¼ í•¨

  ì˜ˆ) êµ¬ì¡°ë§Œ ê°œì„ í•  ë•ŒëŠ” êµ¬ì¡°ë§Œ, ë””í…Œì¼í•œ ë¶€ë¶„ì„ ê°œì„ í•  ë•ŒëŠ” ê·¸ ë¶€ë¶„ë§Œ, ë‹¤ ë°”ê¾¸ê³  ë¬¸ì œê°€ ì—†ì„ ë•Œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì„œ ê°œì„ í•´ì•¼ í•¨

## View ë¶„ë¦¬ - V2

ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì— ë·°ë¡œ ì´ë™í•˜ëŠ” ë¶€ë¶„ì— ì¤‘ë³µ ì¡´ì¬

```java
String viewPath = "/WEB-INF/views/new-form.jsp";
RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
dispatcher.forward(request, response);
```

- ë³„ë„ì˜ ë·°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ ë§Œë“¤ê¸°

**V2 êµ¬ì¡°**

1. HTTP ìš”ì²­
2. FrontController ê°€ URL ë§ëŠ” Controller í˜¸ì¶œ
3. MyView ë°˜í™˜
   - JSP ë¡œ ì§ì ‘ forward í•˜ë˜ ê²ƒì„ í•˜ì§€ ì•Šê³ , veiw ì—­í• ì„ í•˜ëŠ” MyView ê°ì²´ ë§Œë“¤ì–´ì„œ ë°˜í™˜
4. FrontController ê°€ ëŒ€ì‹  MyView render() í˜¸ì¶œ
5. MyView ëŠ” JSP foward í˜¸ì¶œ
6. JSP ê°€ HTML ì‘ë‹µ

ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë” ì´ìƒ JSP foward ì— ëŒ€í•´ì„œ ê³ ë¯¼í•˜ì§€ ì•Šì•„ë„ ë¨, ë‹¨ìˆœíˆ MyView ë§Œ ìƒì„±í•´ì„œ í˜¸ì¶œí•˜ë©´ ë¨

#### MyView

```java
package hello.servlet.web.frontcontroller;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public class MyView {

    private String viewPath;

    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}

```

`render`

- ê¸°ì¡´ JSP ë¡œ ì´ë™í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ë Œë”ë§í•œë‹¤ê³  í‘œí˜„, view ë¥¼ ë§Œë“œëŠ” í–‰ìœ„ ìì²´ë¥¼ ë Œë”ë§í•œë‹¤ê³  í‘œí˜„

#### ControllerV2

```java
package hello.servlet.web.frontcontroller.v2;

import hello.servlet.web.frontcontroller.MyView;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public interface ControllerV2 {

    MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException;
}

```

V1 ê³¼ ë‹¤ë¥¸ ì  : V1 ì—ì„œëŠ” JSP ë¡œ ì´ë™í–ˆì§€ë§Œ, ì—¬ê¸°ì„œëŠ” MyView ë°˜í™˜

#### MemberFormControllerV2 - íšŒì› ë“±ë¡ í¼

```java
package hello.servlet.web.frontcontroller.v2.controller;

import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.ControllerV2;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public class MemberFormControllerV2 implements ControllerV2 {
    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        return new MyView("/WEB-INF/views/new-form.jsp");
    }
}

```

ê° ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë³µì¡í•œ `dispatcher.forward()` ì§ì ‘ ìƒì„±í•´ì„œ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë¨

- MyView ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë·° ì´ë¦„ë§Œ ë„£ê³  ë°˜í™˜í•˜ë©´ ë¨

#### MemberSaveControllerV2 - íšŒì› ì €ì¥

```java
package hello.servlet.web.frontcontroller.v2.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.ControllerV2;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public class MemberSaveControllerV2 implements ControllerV2 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        request.setAttribute("member", member);

        return new MyView("/WEB-INF/views/save-result.jsp");
    }
}

```

#### MemberListControllerV2 - íšŒì› ëª©ë¡

````java
package hello.servlet.web.frontcontroller.v2.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.ControllerV2;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.List;

public class MemberListControllerV2 implements ControllerV2 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        List<Member> members = memberRepository.findAll();
        request.setAttribute("members", members);

        return new MyView("/WEB-INF/views/members.jsp");
    }
}

````

#### í”„ë¡ í„° ì»¨íŠ¸ë¡¤ëŸ¬ V2

```java
package hello.servlet.web.frontcontroller.v2;


import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.controller.MemberFormControllerV2;
import hello.servlet.web.frontcontroller.v2.controller.MemberListControllerV2;
import hello.servlet.web.frontcontroller.v2.controller.MemberSaveControllerV2;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerServletV2", urlPatterns = "/front-controller/v2/*")
public class FrontControllerServletV2 extends HttpServlet {

    private Map<String, ControllerV2> controllerMap = new HashMap<>();

    public FrontControllerServletV2() {
        controllerMap.put("/front-controller/v2/members/new-form", new MemberFormControllerV2());
        controllerMap.put("/front-controller/v2/members/save", new MemberSaveControllerV2());
        controllerMap.put("/front-controller/v2/members", new MemberListControllerV2());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String requestURI = req.getRequestURI();

        ControllerV2 controller = controllerMap.get(requestURI);
        if (controller == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        MyView view = controller.process(req, resp);
        view.render(req, resp);
    }
}

```

í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ í˜¸ì¶œ ê²°ê³¼ë¡œ MyView ë¥¼ ë°˜í™˜ ë°›ê³ , `view.render()` í˜¸ì¶œí•˜ë©´ forward ë¡œì§ì„ ìˆ˜í–‰í•´ì„œ JSP ê°€ ì‹¤í–‰ë¨

í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë„ì…ìœ¼ë¡œ MyView ê°ì²´ì˜ render() ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì„ ëª¨ë‘ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬ ê°€ëŠ¥

ê° ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” MyView ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜ë§Œ í•˜ë©´ ë¨

## Model ì¶”ê°€ - V3

**ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°**(ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ë³€ê²½)

ì»¨íŠ¸ë¡¤ëŸ¬ ì…ì¥ì—ì„œ HttpServletRequest, HttpServletResponse ê¼­ í•„ìš”í•œê°€?

- í•„ìš”í•˜ì§€ ì•Šë‹¤. ìš”ì²­ íŒŒë¼ë¯¸í„° ì •ë³´ëŠ” ìë°”ì˜ Map ìœ¼ë¡œ ëŒ€ì‹  ë„˜ê¸°ë„ë¡ í•˜ë©´, **ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ëª°ë¼ë„ ë™ì‘ ê°€ëŠ¥í•˜ë‹¤.**
- request ê°ì²´ë¥¼ Model ë¡œ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  ë³„ë„ì˜ Model ê°ì²´ ë§Œë“¤ì–´ì„œ ë°˜í™˜

**ë·° ì´ë¦„ ì¤‘ë³µ ì œê±°**

ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ ë°˜í™˜í•˜ë„ë¡ í•˜ì

- /WEB-INF/views/new-form.jsp :arrow_right: new-form
- /WEB-INF/views/save-result.jsp :arrow_right: save-result
- /WEB-INF/views/members.jsp :arrow_right: members

í–¥í›„ ë·°ì˜ í´ë” ìœ„ì¹˜ê°€ í•¨ê»˜ ì´ë™í•´ë„ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ê³ ì¹˜ë©´ ë¨(ë³€ê²½ì˜ ì§€ì  í•˜ë‚˜ë¡œ)

**V3 êµ¬ì¡°**

1. HTTP ìš”ì²­
2. FrontController ê°€ ì•Œë§ì€ Controller í˜¸ì¶œ
3. Controller ëŠ” FrontController ì— ModelView ë°˜í™˜
   - ì´ì „ì—ëŠ” View ë§Œ ë°˜í™˜
4. FrontController ëŠ” viewResolver í˜¸ì¶œ : ë…¼ë¦¬ ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ì—­í• 
5. viewResolver ëŠ” MyView ë¥¼ FrontController ì— ë°˜í™˜
6. FrontController ëŠ” MyView ê°ì²´ë¥¼ í†µí•´ render(model) í˜¸ì¶œ í›„ HTML ì‘ë‹µ

#### ModelView(SpringMVC ì˜ ModelAndView)

```java
package hello.servlet.web.frontcontroller;

import java.util.HashMap;
import java.util.Map;

public class ModelView {
    private String viewName; // view ì˜ ë…¼ë¦¬ ì´ë¦„
    private Map<String, Object> model = new HashMap<>();

    public ModelView(String viewName) {
        this.viewName = viewName;
    }

    public String getViewName(String viewName) {
        return viewName;
    }

    public void setViewName(String viewName) {
        this.viewName = viewName;
    }

    public Map<String, Object> getModel() {
        return model;
    }

    public void setModel(Map<String, Object> model) {
        this.model = model;
    }
}

```

ë·°ì˜ ì´ë¦„ê³¼ ë·°ë¥¼ ë Œë”ë§í•  ë•Œ í•„ìš”í•œ model ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆìŒ

#### ControllerV3

```java
package hello.servlet.web.frontcontroller.v3;

import hello.servlet.web.frontcontroller.ModelView;

import java.util.Map;

public interface ControllerV3 {

    ModelView process(Map<String, String> paramMap);
}

```

ì„œë¸”ë¦¿ ê¸°ìˆ  ì‚¬ìš© X

- êµ¬í˜„ì´ ë‹¨ìˆœí•´ì§€ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì‹œ í…ŒìŠ¤íŠ¸ í•˜ê¸° ì‰¬ì›€

HttpServletRequest ê°€ ì œê³µí•˜ëŠ” íŒŒë¼ë¯¸í„°ëŠ” í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ paramMap ì— ë‹´ì•„ì„œ í˜¸ì¶œí•´ì£¼ë©´ ë¨

#### MemberFormControllerV3 - íšŒì› ë“±ë¡ í¼

```java
package hello.servlet.web.frontcontroller.v3.controller;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.Map;

public class MemberFormControllerV3 implements ControllerV3 {
    @Override
    public ModelView process(Map<String, String> paramMap) {
        return new ModelView("new-form");
    }
}

```

ModelView ìƒì„± ì‹œ, new-form ê°™ì€ viewì˜ ë…¼ë¦¬ì  ì´ë¦„ì„ ì§€ì •. ì´ëŠ” í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬

#### MemberSaveControllerV3 - íšŒì› ì €ì¥

```java
package hello.servlet.web.frontcontroller.v3.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.Map;

public class MemberSaveControllerV3 implements ControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        ModelView mv = new ModelView("save-result");
        mv.getModel().put("member", member);
        return mv;
    }
}

```

`paramMap.get("username");`

- íŒŒë¼ë¯¸í„° ì •ë³´ map ì— ì¡´ì¬, ì¦‰ request ì—ì„œ ë¹¼ì˜¤ë˜ `getParamter()` ì™€ ê°™ì€ ê²ƒ
- ë‹¤ë§Œ, HttpRequestServlet ë¥¼ ì—¬ê¸°ì„œëŠ” ì´ìš©í•˜ì§€ ì•ŠìŒ

`mv.getModel().put("member", member);`

ëª¨ë¸ì€ ë‹¨ìˆœ map ì´ë¯€ë¡œ ëª¨ë¸ì— ë·°ì—ì„œ í•„ìš”í•œ member ê°ì²´ ë‹´ê³  ë°˜í™˜

#### MemberListControllerV3 - íšŒì› ëª©ë¡

```java
package hello.servlet.web.frontcontroller.v3.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;

import java.util.List;
import java.util.Map;

public class MemberListControllerV3 implements ControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {
        List<Member> members = memberRepository.findAll();

        ModelView mv = new ModelView("members");
        mv.getModel().put("members", members);
        return mv;
    }
}

```

#### FrontControllerServletV3

```java
package hello.servlet.web.frontcontroller.v3;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v3.controller.MemberFormControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberListControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberSaveControllerV3;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerServletV3", urlPatterns = "/front-controller/v3/*")
public class FrontControllerServletV3 extends HttpServlet {

    private Map<String, ControllerV3> controllerMap = new HashMap<>();

    public FrontControllerServletV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String requestURI = req.getRequestURI();

        ControllerV3 controller = controllerMap.get(requestURI);
        if(controller == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        Map<String, String> paramMap = createParamMap(req);
        ModelView mv = controller.process(paramMap);

        String viewName = mv.getViewName();
        MyView view = viewResolver(viewName);
        view.render(mv.getModel(), req, resp);
    }

    private Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }

    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}

```

`createParamMap`

- HttpServletRequest ì—ì„œ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ êº¼ë‚´ì„œ Map ìœ¼ë¡œ ë³€í™˜

`viewResolver`

- ì˜ˆ) ë…¼ë¦¬ ë·° ì´ë¦„ : members -> ë¬¼ë¦¬ ë·° ê²½ë¡œ : /WEB-INF/views/members.jsp
- ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°˜í™˜í•œ ë…¼ë¦¬ ë·° ì´ë¦„ì„ ì‹¤ì œ ë¬¼ë¦¬ ë·°ë¡œ ë³€ê²½
- ì‹¤ì œ ë¬¼ë¦¬ ê²½ë¡œê°€ ìˆëŠ” MyView ê°ì²´ ë°˜í™˜

`view.render(mv.getModel(), req, resp);`

- ë·° ê°ì²´ë¥¼ í†µí•´ HTML í™”ë©´ ë Œë”ë§

#### MyView

```java
package hello.servlet.web.frontcontroller;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.Map;

public class MyView {

    private String viewPath;

    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        modelToRequestAttribute(model, request);
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    private void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
        model.forEach((key, value) -> request.setAttribute(key, value));
    }
}

```

`modelToRequestAttribute`

- ëª¨ë¸ì— ìˆëŠ” ë°ì´í„°ë¥¼ request ì˜ attribute ë¡œ ë°”ê¾¼ë‹¤.
- ì´ ê³¼ì •ì´ í•„ìš”í•œ ì´ìœ ëŠ” ì›ë˜ view ì—ëŠ” request ì— ê°’ì„ ë‹´ì•„ì„œ(setAttribute) ë„˜ê²¨ì¤˜ì•¼ í•˜ëŠ”ë°, Model ì„ ë„ì…í•˜ë©´ì„œ, ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ì—ì„œ ë¹ ì¡Œê¸° ë•Œë¬¸ì— MyView ê°ì²´ë¡œ render í•  ë•Œ. ë„£ì–´ì¤€ ê²ƒ

## ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ - V4

ê°œë°œì ì…ì¥ì—ì„œ ë³´ë©´, í•­ìƒ ModelView ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•˜ëŠ” ë¶€ë¶„ ë²ˆê±°ë¡­ë‹¤

**V4 êµ¬ì¡°**(êµ¬ì¡°ì ìœ¼ë¡œëŠ” V3 ì™€ ë¹„ìŠ·)

1. HTTP ìš”ì²­
2. FrontController ëŠ” ì•Œë§ì€ Controller ë¥¼ í˜¸ì¶œ
   - âœ…  í˜¸ì¶œí•  ë•Œ, paramMap ê³¼ model ì„ ë„˜ê²¨ì¤Œ
3. Controller ëŠ” FrontController ì— ViewName ì„ ë°˜í™˜
   - V3 ì™€ ë‹¤ë¥´ê²Œ ModelView ê°€ ì•„ë‹Œ ViewName ë°˜í™˜
4. FrontController ëŠ” viewResolver í˜¸ì¶œ
5. viewResolver ëŠ” FrontController ì— MyView ë°˜í™˜
6. FrontController ëŠ” MyView ê°ì²´ë¥¼ í†µí•´ render(model) í˜¸ì¶œ
7. MyView ëŠ” HTML ì‘ë‹µ

#### ControllerV4

```java
package hello.servlet.web.frontcontroller.v4;

import java.util.Map;

public interface ControllerV4 {
    /**
     * @param paramMap
     * @param model
     * @return viewName
     */
    String process(Map<String, String> paramMap, Map<String, Object> model);
}

```

ModelView ê°€ ì—†ë‹¤

- Model ê°ì²´ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ë¯€ë¡œ ì‚¬ìš©í•˜ë©´ ë˜ê³ , ê²°ê³¼ë¡œ ë·° ì´ë¦„ë§Œ ë°˜í™˜



#### MemberFormControllerV4

```java
package hello.servlet.web.frontcontroller.v4.controller;

import hello.servlet.web.frontcontroller.v4.ControllerV4;

import java.util.Map;

public class MemberFormControllerV4 implements ControllerV4 {
    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        return "new-form";
    }
}

```

#### MemberSaveControllerV4

```java
package hello.servlet.web.frontcontroller.v4.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.v4.ControllerV4;

import java.util.Map;

public class MemberSaveControllerV4 implements ControllerV4 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        model.put("member", member);

        return "save-result";
    }
}

```

`model.put("member", member);`

- ëª¨ë¸ì´ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ê¸° ë•Œë¬¸ì—, ëª¨ë¸ ì§ì ‘ ìƒì„±í•˜ì§€ X

#### MemberListControllerV4

```java
package hello.servlet.web.frontcontroller.v4.controller;

import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.v4.ControllerV4;

import java.util.List;
import java.util.Map;

public class MemberListControllerV4 implements ControllerV4 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        List<Member> members = memberRepository.findAll();
        model.put("members", members);

        return "members";
    }
}

```

#### FrontControllerServletV4

```java
package hello.servlet.web.frontcontroller.v4;

import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v4.controller.MemberFormControllerV4;
import hello.servlet.web.frontcontroller.v4.controller.MemberListControllerV4;
import hello.servlet.web.frontcontroller.v4.controller.MemberSaveControllerV4;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@WebServlet(name = "frontControllerServletV4", urlPatterns = "/front-controller/v4/*")
public class FrontControllerServletV4 extends HttpServlet {

    private Map<String, ControllerV4> controllerMap = new HashMap<>();

    public FrontControllerServletV4() {
        controllerMap.put("/front-controller/v4/members/new-form", new MemberFormControllerV4());
        controllerMap.put("/front-controller/v4/members/save", new MemberSaveControllerV4());
        controllerMap.put("/front-controller/v4/members", new MemberListControllerV4());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String requestURI = req.getRequestURI();

        ControllerV4 controller = controllerMap.get(requestURI);
        if (controller == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        Map<String, String> paramMap = createParamMap(req);
        Map<String, Object> model = new HashMap<>();

        String viewName = controller.process(paramMap, model);

        MyView view = viewResolver(viewName);
        view.render(model, req, resp);
    }

    private Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));

        return paramMap;
    }

    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}

```

**ëª¨ë¸ ê°ì²´ ì „ë‹¬**

ëª¨ë¸ ê°ì²´ë¥¼ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ìƒì„±í•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë„˜ê²¨ì¤Œ

**ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ì§ì ‘ ë°˜í™˜**

ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì§ì ‘ ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ ë°˜í™˜, ì´ ê°’ìœ¼ë¡œ ì‹¤ì œ ë¬¼ë¦¬ ë·° ì°¾ì„ ìˆ˜ ìˆìŒ

##### ì •ë¦¬

- ê¸°ì¡´ êµ¬ì¡°ì—ì„œ ëª¨ë¸ì„ íŒŒë¼ë¯¸í„°ì— ë„˜ê¸°ê³ , ë·° ë…¼ë¦¬ ì´ë¦„ì„ ë°˜í™˜í•˜ëŠ” ë‘ ê°€ì§€ë§Œ ì ìš©í–ˆì„ ë¿ì¸ë°, ModelView ë¥¼ ë°˜í™˜í•  í•„ìš”ê°€ X

## ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬ 1 - V5

V4 ì˜ ìœ ì¼í•œ ë‹¨ì ì€ í•­ìƒ ëª¨ì–‘ì´ ì •í•´ì ¸ ìˆëŠ” ê²ƒ

ì˜ˆ) ê°œë°œí•˜ë‹¤ê°€ V4 ê°€ ì•„ë‹Œ V1 ì„ ì“°ê³  ì‹¶ë‹¤ë©´? ë‘˜ ë‹¤ ì„ì–´ì„œ ì“°ê³  ì‹¶ë‹¤ë©´?

ì–´ë–¤ Controller ë„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” FrontController ë§Œë“¤ ê²ƒ

### ì–´ëŒ‘í„° íŒ¨í„´

ìš°ë¦¬ê°€ ê°œë°œí•œ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” í•œê°€ì§€ ë°©ì‹ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë§Œ ì‚¬ìš© ê°€ëŠ¥í–ˆìŒ

ì´ëŸ´ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ë¡œ ì–´ëŒ‘í„°

**V5 êµ¬ì¡°**

1. HTTP ìš”ì²­
2. FrontController ëŠ” í•¸ë“¤ëŸ¬ ë§¤í•‘ ì •ë³´ì—ì„œ í•¸ë“¤ëŸ¬ë¥¼ ì¡°íšŒ
3. FrontController ëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ëª©ë¡ì—ì„œ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì¡°íšŒ
   - ê¸°ì¡´ì—ëŠ” FrontController ì—ì„œ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬) ë°”ë¡œ í˜¸ì¶œí–ˆì§€ë§Œ ì´ ë²„ì „ì—ì„œëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ í†µí•´ì„œ í˜¸ì¶œ
   - í•¸ë“¤ëŸ¬ë¼ëŠ” ê°œë…ì€ Controller ë¼ê³  ìƒê°í•˜ë©´ ë¨
4. FrontController ëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ëª©ë¡ì—ì„œ ë°›ì•„ì˜¨ ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ ì•Œë§ì€ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ
   - `handle(handler)`
5. í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ëŠ” í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬) í˜¸ì¶œí•œ í›„, ë°˜í™˜ë°›ì€ ModelView ë¥¼ FrontController ì—ê²Œ ModelView ë°˜í™˜
6. FrontController ëŠ” ë°˜í™˜ë°›ì€ ModelView ë¡œ viewResolver í˜¸ì¶œ
7. viewReslover ëŠ” FrontController ì— MyView ë°˜í™˜
8. FrontController ëŠ” ë°˜í™˜ë°›ì€ MyView ë¡œ render(model) í˜¸ì¶œ
9. MyView ëŠ” HTML ì‘ë‹µ

- **í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°**

  : ì¤‘ê°„ ì–´ëŒ‘í„° ì—­í• , ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•œë‹¤

- **í•¸ë“¤ëŸ¬**

  : ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì´ë¦„ì„ ë” ë„“ì€ ë²”ìœ„ì¸ í•¸ë“¤ëŸ¬ë¡œ ë³€ê²½

#### MyHandlerAdapter

```java
package hello.servlet.web.frontcontroller.v5;

import hello.servlet.web.frontcontroller.ModelView;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;

public interface MyHandlerAdapter {

    boolean supports(Object handler);

    ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException;
    
}

```

`boolean supports(Object handler);`

- ì–´ëŒ‘í„°ê°€ í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ íŒë‹¨í•˜ëŠ” ë©”ì„œë“œ

`ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException;`

- ì–´ëŒ‘í„°ëŠ” ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ê³ , ê·¸ ê²°ê³¼ë¡œ ModelView ë°˜í™˜

#### ControllerV3HandlerAdapter

```java
package hello.servlet.web.frontcontroller.v5.adapter;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v3.ControllerV3;
import hello.servlet.web.frontcontroller.v5.MyHandlerAdapter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

public class ControllerV3HandlerAdapter implements MyHandlerAdapter {
    @Override
    public boolean supports(Object handler) {
        return handler instanceof ControllerV3;
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {

        ControllerV3 controller = (ControllerV3) handler;

        Map<String, String> paramMap = createParamMap(request);

        ModelView mv = controller.process(paramMap);
        
        return mv;
    }

    private Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));

        return paramMap;
    }
}

```

#### FrontControllerServletV5

```java
package hello.servlet.web.frontcontroller.v5;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v3.controller.MemberFormControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberListControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberSaveControllerV3;
import hello.servlet.web.frontcontroller.v5.adapter.ControllerV3HandlerAdapter;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@WebServlet(name = "frontControllerServletV5", urlPatterns = "/front-controller/v5/*")
public class FrontControllerServletV5 extends HttpServlet {

    private final Map<String, Object> handlerMappingMap = new HashMap<>();
    private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();

  // í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ ì–´ëŒ‘í„° ì´ˆê¸°í™”(ë“±ë¡)
    public FrontControllerServletV5() {
        initHandlerMappingMap(); // í•¸ë“¤ëŸ¬ ë§¤í•‘ ì´ˆê¸°í™”
        initHandlerAdapters(); // ì–´ëŒ‘í„° ì´ˆê¸°í™”
    }

    private void initHandlerMappingMap() {
        handlerMappingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());
    }

    private void initHandlerAdapters() {
        handlerAdapters.add(new ControllerV3HandlerAdapter());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        Object handler = getHandler(req);
        if (handler == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        MyHandlerAdapter adapter = getHandlerAdapter(handler);
      
      	// ì–´ëŒ‘í„° í˜¸ì¶œ : ê·¸ ê²°ê³¼ë¥¼ ì–´ëŒ‘í„°ì— ë§ì¶”ì–´ ë°˜í™˜
        ModelView mv = adapter.handle(req, resp, handler);

        MyView view = viewResolver(mv.getViewName());
        view.render(mv.getModel(), req, resp);

    }

  	// í•¸ë“¤ëŸ¬ ë§¤í•‘ : URL ì— ë§¤í•‘ëœ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬) ê°ì²´ ë°˜í™˜
    private Object getHandler(HttpServletRequest request) {
        String requestURI = request.getRequestURI();
        return handlerMappingMap.get(requestURI);
    }

  	// í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬) ì²˜ë¦¬ ê°€ëŠ¥í•œ ì–´ëŒ‘í„° ì¡°íšŒ
    private MyHandlerAdapter getHandlerAdapter(Object handler) {
        for (MyHandlerAdapter adapter : handlerAdapters) {
            if (adapter.supports(handler)) {
                return adapter;
            }
        }

        throw new IllegalArgumentException("handler adapter ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. handler = " + handler);
    }

    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}

```

`initHandlerMappingMap();`, `initHandlerAdapters();`

- ìˆœì„œëŒ€ë¡œ Controller ë§¤í•‘ì •ë³´, Adapter ë§¤í•‘ ì •ë³´

ì»¨íŠ¸ë¡¤ëŸ¬ -> í•¸ë“¤ëŸ¬ : ì´ë¦„ ë³€ê²½ ì´ìœ 

- ì´ì „ì—ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì§ì ‘ ë§¤í•‘, ì´ì œëŠ” ì–´ëŒ‘í„° ì‚¬ìš©í•˜ë¯€ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ë¿ë§Œ ì•„ë‹ˆë¼ ì–´ëŒ‘í„°ê°€ ì§€ì›í•˜ê¸°ë§Œ í•˜ë©´, ì–´ë–¤ ê²ƒë„ URL ì— ë§¤í•‘í•´ì„œ ì‚¬ìš© ê°€ëŠ¥

#### FrontControllerServletV5 ì— ControllerV4 ê¸°ëŠ¥ë„ ì¶”ê°€

```java
package hello.servlet.web.frontcontroller.v5;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v3.controller.MemberFormControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberListControllerV3;
import hello.servlet.web.frontcontroller.v3.controller.MemberSaveControllerV3;
import hello.servlet.web.frontcontroller.v4.controller.MemberFormControllerV4;
import hello.servlet.web.frontcontroller.v4.controller.MemberListControllerV4;
import hello.servlet.web.frontcontroller.v4.controller.MemberSaveControllerV4;
import hello.servlet.web.frontcontroller.v5.adapter.ControllerV3HandlerAdapter;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@WebServlet(name = "frontControllerServletV5", urlPatterns = "/front-controller/v5/*")
public class FrontControllerServletV5 extends HttpServlet {

    private final Map<String, Object> handlerMappingMap = new HashMap<>();
    private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();

    public FrontControllerServletV5() {
        initHandlerMappingMap();
        initHandlerAdapters();
    }

    private void initHandlerMappingMap() {
        handlerMappingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());

        handlerMappingMap.put("/front-controller/v5/v4/members/new-form", new MemberFormControllerV4());
        handlerMappingMap.put("/front-controller/v5/v4/members/save", new MemberSaveControllerV4());
        handlerMappingMap.put("/front-controller/v5/v4/members", new MemberListControllerV4());
    }

    private void initHandlerAdapters() {
        handlerAdapters.add(new ControllerV3HandlerAdapter());
        handlerAdapters.add(new ControllerV4HandlerAdapter());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        Object handler = getHandler(req);
        if (handler == null) {
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        MyHandlerAdapter adapter = getHandlerAdapter(handler);
        ModelView mv = adapter.handle(req, resp, handler);

        MyView view = viewResolver(mv.getViewName());
        view.render(mv.getModel(), req, resp);


    }

    private Object getHandler(HttpServletRequest request) {
        String requestURI = request.getRequestURI();
        return handlerMappingMap.get(requestURI);
    }

    private MyHandlerAdapter getHandlerAdapter(Object handler) {
        for (MyHandlerAdapter adapter : handlerAdapters) {
            if (adapter.supports(handler)) {
                return adapter;
            }
        }

        throw new IllegalArgumentException("handler adapter ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. handler = " + handler);
    }

    private MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}

```

í•¸ë“¤ëŸ¬ ë§¤í•‘(ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘) V4 ì¶”ê°€

í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ë§¤í•‘ V4 ì¶”ê°€

#### ControllerV4HandlerAdapter

```java
package hello.servlet.web.frontcontroller.v5.adapter;

import hello.servlet.web.frontcontroller.ModelView;
import hello.servlet.web.frontcontroller.v4.ControllerV4;
import hello.servlet.web.frontcontroller.v5.MyHandlerAdapter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

public class ControllerV4HandlerAdapter implements MyHandlerAdapter {
    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV4);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {
        ControllerV4 controller = (ControllerV4) handler;

        Map<String, String> paramMap = createParamMap(request);
        Map<String, Object> model = new HashMap<>();

        String viewName = controller.process(paramMap, model);

        // ì–´ëŒ‘í„° ë³€í™˜
        ModelView mv = new ModelView(viewName);
        mv.setModel(model);

        return mv;
    }

    private Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));

        return paramMap;
    }
}

```

ì–´ëŒ‘í„°ê°€ í˜¸ì¶œí•˜ëŠ” ControllerV4 ëŠ” ë·°ì˜ ì´ë¦„ì„ ë°˜í™˜

-> ê·¸ëŸ¬ë‚˜ ì–´ëŒ‘í„°ëŠ” ë·°ì˜ ì´ë¦„ì´ ì•„ë‹ˆë¼ ModelView ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜, ì–´ëŒ‘í„°ëŠ” ModelView ë¥¼ ë°˜í™˜í•´ì•¼í•œë‹¤ëŠ” ê·œì¹™ì— ë§ì¶°ì„œ ë°˜í™˜. ì´ê²Œ ë°”ë¡œ ì–´ëŒ‘í„°ì˜ í•„ìš”ì„±(í™•ì¥ì„±)

>  ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ ë¶„ë¦¬
>
> í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì¸í„°í˜ì´ìŠ¤ë¡œ ë˜ì–´ ìˆìŒ. ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ í˜¸ì¶œ, ì•ˆë˜ëŠ” ê±´ ì–´ëŒ‘í„°ë¥¼ í†µí•´ ë§ì¶¤
>
> init ë¶€ë¶„ë“¤ë§Œ ë°–ì—ì„œ ì£¼ì…í•˜ë„ë¡ ì„¤ê³„ ë°”ê¾¸ë©´ ê¹”ë”í•´ì§

## ì •ë¦¬

**V1** : í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì…

**V2** : View ë¶„ë¦¬(ë‹¨ìˆœ ë°˜ë³µ ë·° ë¡œì§ ë¶„ë¦¬)

**V3** : Model ì¶”ê°€(ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°, ë·° ì´ë¦„ ì¤‘ë³µ ì œê±°)

**V4** : ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬(paramMap, model ì„ ì»¨íŠ¸ë¡¤ëŸ¬ì— ê°™ì´ ë„˜ê²¨ì£¼ì–´, ModelView ìƒì„± X)

**V5** : ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬(ì–´ëŒ‘í„° ë„ì…, ì–´ëŒ‘í„° ì¶”ê°€í•˜ì—¬ í™•ì¥ì„± ë†’ì„)

---

ì¶œì²˜ : https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1